name: EditorConfig Rules Check

on: [pull_request]

jobs:
  check-editorconfig:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install EditorConfig Checker
        run: |
          curl -sSfL https://github.com/editorconfig-checker/editorconfig-checker/releases/latest/download/ec-linux-amd64.tar.gz -o ec.tar.gz
          mkdir -p ec-temp
          tar -xzf ec.tar.gz -C ec-temp
          
          # Dynamically find the binary
          EC_PATH=$(find ec-temp -type f -name "ec-linux-amd64" -perm -111 | head -n 1)
          
          if [ -z "$EC_PATH" ]; then
            echo "‚ùå Could not locate ec-linux-amd64 binary in archive"
            exit 1
          fi
          
          # Move and rename to /usr/local/bin/ec
          sudo mv "$EC_PATH" /usr/local/bin/ec
          sudo chmod +x /usr/local/bin/ec
          
          # Clean up the temp dir
          rm -rf ec-temp ec.tar.gz

      - name: Run EditorConfig Checker and Show Help
        run: |
          echo "üîç Running EditorConfig Checker..."

          if ec; then
            echo "‚úÖ EditorConfig Checker Success"
          else
            echo ""
            echo "‚ùå One or more files do not conform to .editorconfig rules."
            echo ""
            echo "üìò Common IDE Setup Help"
            echo ""
            echo "üß† Visual Studio:"
            echo "  ‚û§ Tools > Options > Text Editor > [Language] > Code Style > General"
            echo "  ‚û§ Enable: 'Detect EditorConfig settings'"
            echo "  ‚û§ Optionally enable: 'Reformat on save' under Code Cleanup"
            echo ""
            echo "üß∞ JetBrains Rider:"
            echo "  ‚û§ Preferences > Editor > Code Style"
            echo "  ‚û§ Enable: 'Enable EditorConfig support'"
            echo "  ‚û§ Re-save affected files to apply formatting"
            echo ""
            echo "üí° Visual Studio Code:"
            echo "  ‚û§ Install the 'EditorConfig for VS Code' extension"
            echo "  ‚û§ Enable 'files.insertFinalNewline' and 'files.trimTrailingWhitespace'"
            echo ""
            echo "üìù Notepad++:"
            echo "  ‚û§ Settings > Preferences > MISC ‚Üí Enable 'Final line ending'"
            echo "  ‚û§ Settings > Preferences > Language ‚Üí Tab Settings ‚Üí Enable 'Replace by space'"
            echo ""
            echo "üîß Other Common Editors for .NET:"
            echo "  ‚Ä¢ JetBrains ReSharper (Visual Studio extension)"
            echo "  ‚Ä¢ OmniSharp-enabled editors (like NeoVim, Sublime Text)"
            echo "  ‚Ä¢ Emacs (with editorconfig plugin)"
            echo "  ‚Ä¢ Vim (with editorconfig-vim plugin)"
            echo ""
            echo "üåç Other editors:"
            echo "  ‚û§ Check if your editor supports .editorconfig:"
            echo "    ‚Üí https://editorconfig.org/#pre-installed"
            echo "    ‚Üí https://editorconfig.org/#download"
            echo ""
            echo "‚úÖ After configuration, open the file and make a whitespace-only edit, then save."
            echo "   This will apply your configured formatting and resolve the error."
            exit 1
          fi
